# TUI æ”¹è¿›æ€»ç»“ - 2025å¹´07æœˆ

## ğŸ¯ æ”¹è¿›ç›®æ ‡

åŸºäºç”¨æˆ·åé¦ˆï¼Œæˆ‘ä»¬å¯¹ TUI (Terminal User Interface) è¿›è¡Œäº†å…¨é¢çš„æ”¹è¿›ï¼Œé‡ç‚¹è§£å†³äº†ï¼š

1. **åŠ¨æ€æ»šåŠ¨** - ä¸å¼ºåˆ¶æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œéšæ¶ˆæ¯å¢åŠ è‡ªç„¶æ»šåŠ¨
2. **åŠ¨æ€è¾“å…¥æ¡†ä½ç½®** - è¾“å…¥æ¡†è·Ÿéšæœ€æ–°ä¿¡æ¯çš„åº•éƒ¨
3. **ä¸­æ–‡è¾“å…¥æ”¯æŒ** - å¢å¼º UTF-8 å’Œä¸­æ–‡å­—ç¬¦å¤„ç†èƒ½åŠ›
4. **å¼€æºç»„ä»¶è°ƒç ”** - å¯»æ‰¾æ›´å¥½çš„è¾“å…¥æ¡†è§£å†³æ–¹æ¡ˆ

## ğŸ” å¼€æºç»„ä»¶è°ƒç ”ç»“æœ

### æ¨èæ–¹æ¡ˆ: Bubble Tea + Bubbles â­â­â­â­â­

**æ ¸å¿ƒåº“**:
- `charmbracelet/bubbletea` - åŸºäº Elm Architecture çš„ TUI æ¡†æ¶
- `charmbracelet/bubbles` - åŒ…å« TextInput, TextArea ç­‰é¢„æ„å»ºç»„ä»¶
- `charmbracelet/lipgloss` - æ ·å¼å’Œå¸ƒå±€åº“

**ä¼˜åŠ¿**:
- âœ… å®Œæ•´çš„ Unicode æ”¯æŒ (ä¸­æ–‡æ˜¾ç¤ºæ— é—®é¢˜)
- âœ… ç”Ÿäº§çº§è´¨é‡ (10,000+ åº”ç”¨ä½¿ç”¨)
- âœ… æ´»è·ƒç»´æŠ¤ (2025å¹´4æœˆæœ€æ–°æ›´æ–°)
- âœ… å…ˆè¿›çš„çŠ¶æ€ç®¡ç†å’Œç»„ä»¶æ¶æ„

**å…¶ä»–é€‰æ‹©**:
- **Tview** - åŸºäº tcellï¼Œå¿«é€Ÿå¼€å‘ï¼Œé¢„æ„å»ºç»„ä»¶ä¸°å¯Œ
- **Huh** - ä¸“é—¨ç”¨äºç®€å•è¡¨å•å’Œæç¤ºï¼Œæ˜“äºä½¿ç”¨

## ğŸš€ æŠ€æœ¯æ”¹è¿›å®ç°

### 1. æ™ºèƒ½æ»šåŠ¨ç³»ç»Ÿ

**æ ¸å¿ƒæ”¹è¿›**: `PrintInScrollRegion()` æ–¹æ³•é‡æ„

```go
// æ–°å¢å­—æ®µ
type TerminalController struct {
    contentHeight int  // å½“å‰å†…å®¹é«˜åº¦
    scrollOffset  int  // å½“å‰æ»šåŠ¨åç§»
    // ... å…¶ä»–å­—æ®µ
}

// æ™ºèƒ½æ»šåŠ¨é€»è¾‘
if tc.contentHeight > availableHeight {
    // åªæœ‰å†…å®¹è¶…å‡ºå¯ç”¨ç©ºé—´æ—¶æ‰æ»šåŠ¨
    scrollNeeded := tc.contentHeight - availableHeight
    fmt.Print(content)
    tc.scrollOffset = scrollNeeded
} else {
    // å†…å®¹é€‚åˆå¯ç”¨ç©ºé—´ï¼Œæ­£å¸¸æ‰“å°
    fmt.Print(content)
}
```

**æ•ˆæœ**: 
- âœ… è¿›å…¥ CLI åä¸ä¼šè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
- âœ… åªæœ‰å½“å†…å®¹è¶…å‡ºå±å¹•æ—¶æ‰å¼€å§‹æ»šåŠ¨
- âœ… æ»šåŠ¨æ›´åŠ è‡ªç„¶å’Œå¹³æ»‘

### 2. åŠ¨æ€è¾“å…¥æ¡†ä½ç½®

**æ ¸å¿ƒæ”¹è¿›**: `ShowDynamicBottomInterface()` æ–¹æ³•

```go
// åŠ¨æ€è®¡ç®—è¾“å…¥æ¡†ä½ç½®
if tc.contentHeight <= availableHeight-4 {
    // å†…å®¹å°‘æ—¶ï¼Œè¾“å…¥æ¡†è·Ÿéšå†…å®¹åº•éƒ¨
    workingLine = tc.scrollRegionTop + tc.contentHeight + 1
    inputStartLine = workingLine + 2
} else {
    // å†…å®¹å¤šæ—¶ï¼Œè¾“å…¥æ¡†å›ºå®šåœ¨å±å¹•åº•éƒ¨
    workingLine = tc.height - 4
    inputStartLine = tc.height - 2
}
```

**æ•ˆæœ**:
- âœ… åˆå§‹çŠ¶æ€è¾“å…¥æ¡†ç´§è·Ÿåœ¨æ¬¢è¿ä¿¡æ¯ä¸‹æ–¹
- âœ… éšç€å¯¹è¯å¢åŠ ï¼Œè¾“å…¥æ¡†è‡ªç„¶ä¸‹ç§»
- âœ… å†…å®¹è¶…å‡ºå±å¹•æ—¶ï¼Œè¾“å…¥æ¡†å›ºå®šåœ¨åº•éƒ¨

### 3. ä¸­æ–‡è¾“å…¥å¢å¼º

**æ ¸å¿ƒæ”¹è¿›**: UTF-8 å’Œå®½å­—ç¬¦æ”¯æŒ

```go
// UTF-8 å­—ç¬¦å¤„ç†
func (tc *TerminalController) ProcessInputBuffer(input []byte) (string, bool) {
    inputStr := string(input)  // è½¬æ¢ä¸º UTF-8 å­—ç¬¦ä¸²
    
    for _, r := range inputStr {  // æŒ‰ rune å¤„ç†ï¼Œä¸æ˜¯ byte
        if unicode.IsPrint(r) || unicode.IsLetter(r) || 
           unicode.IsDigit(r) || unicode.IsSymbol(r) || 
           unicode.IsPunct(r) {
            tc.inputBuffer += string(r)
        }
    }
}

// ä¸­æ–‡å­—ç¬¦å®½åº¦è®¡ç®—
func (tc *TerminalController) calculateDisplayWidth(s string) int {
    width := 0
    for _, r := range s {
        if unicode.Is(unicode.Han, r) || unicode.Is(unicode.Hangul, r) ||
           unicode.Is(unicode.Hiragana, r) || unicode.Is(unicode.Katakana, r) {
            width += 2  // ä¸œäºšå®½å­—ç¬¦å 2ä¸ªä½ç½®
        } else {
            width++     // å…¶ä»–å­—ç¬¦å 1ä¸ªä½ç½®
        }
    }
    return width
}
```

**æ•ˆæœ**:
- âœ… æ­£ç¡®å¤„ç†ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡è¾“å…¥
- âœ… é€€æ ¼é”®æ­£ç¡®åˆ é™¤å¤šå­—èŠ‚å­—ç¬¦
- âœ… æ˜¾ç¤ºå®½åº¦è®¡ç®—å‡†ç¡®ï¼Œé¿å…ç•Œé¢é”™ä½
- âœ… æ”¯æŒæ‰€æœ‰ Unicode å¯æ‰“å°å­—ç¬¦

### 4. æ”¹è¿›çš„ç»ˆç«¯çŠ¶æ€ç®¡ç†

**æ ¸å¿ƒæ”¹è¿›**: æ›´å¥½çš„ cleanup å’Œå…‰æ ‡ç®¡ç†

```go
func (tc *TerminalController) Cleanup() {
    // å…ˆç¦ç”¨åŸå§‹æ¨¡å¼
    tc.disableRawMode()
    
    // å…‰æ ‡ç§»åŠ¨åˆ°æ»šåŠ¨åŒºåŸŸåº•éƒ¨ï¼Œè€Œä¸æ˜¯å±å¹•åº•éƒ¨
    tc.moveCursor(1, tc.scrollRegionBot+1)
    fmt.Print("\n")
}
```

**æ•ˆæœ**:
- âœ… é€€å‡ºåå‘½ä»¤è¡Œä½ç½®æ­£ç¡®
- âœ… ç»ˆç«¯çŠ¶æ€å®Œå…¨æ¢å¤
- âœ… æ— æ®‹ç•™æ˜¾ç¤ºé—®é¢˜

## ğŸ“Š æ€§èƒ½ç‰¹ç‚¹

- **å†…å­˜æ•ˆç‡**: æ™ºèƒ½çš„å†…å®¹é«˜åº¦è·Ÿè¸ªï¼Œé¿å…ä¸å¿…è¦çš„é‡ç»˜
- **å“åº”é€Ÿåº¦**: éé˜»å¡è¾“å…¥å¤„ç†ï¼Œ10ms å»¶è¿Ÿé¿å…å¿™ç­‰å¾…
- **å…¼å®¹æ€§**: æ”¯æŒ macOS/Darwin åŸç”Ÿç³»ç»Ÿè°ƒç”¨
- **å¯æ‰©å±•æ€§**: ä¸ºå°†æ¥é›†æˆ Bubble Tea ç»„ä»¶åšå¥½å‡†å¤‡

## ğŸ”® æœªæ¥è§„åˆ’

### è¿‘æœŸæ”¹è¿›
1. **é›†æˆ Bubble Tea TextInput** - è·å¾—æ›´å¼ºå¤§çš„è¾“å…¥ç¼–è¾‘åŠŸèƒ½
2. **æ·»åŠ è¾“å…¥å†å²** - ä¸Šä¸‹é”®æµè§ˆå†å²å‘½ä»¤
3. **è¯­æ³•é«˜äº®** - é’ˆå¯¹ä»£ç ç‰‡æ®µçš„è¾“å…¥é«˜äº®

### é•¿æœŸè§„åˆ’
1. **å®Œæ•´è¿ç§»åˆ° Bubble Tea** - åˆ©ç”¨æˆç†Ÿçš„ TUI æ¡†æ¶
2. **å¤šçª—æ ¼æ”¯æŒ** - åŒæ—¶æ˜¾ç¤ºå¯¹è¯ã€æ–‡ä»¶æ ‘ã€å·¥å…·è¾“å‡º
3. **ä¸»é¢˜ç³»ç»Ÿ** - æ”¯æŒæ˜æš—ä¸»é¢˜å’Œè‡ªå®šä¹‰é…è‰²

## ğŸ§ª æµ‹è¯•å»ºè®®

```bash
# æµ‹è¯•ä¸­æ–‡è¾“å…¥
./alex -i
# è¾“å…¥: ä½ å¥½ï¼Œè¿™æ˜¯ä¸­æ–‡æµ‹è¯•

# æµ‹è¯•åŠ¨æ€æ»šåŠ¨
./alex -i  
# è¾“å…¥å¤šæ¡æ¶ˆæ¯ï¼Œè§‚å¯Ÿæ»šåŠ¨è¡Œä¸º

# æµ‹è¯•è¾“å…¥æ¡†ä½ç½®
./alex -i
# åœ¨ä¸åŒå†…å®¹é‡ä¸‹è§‚å¯Ÿè¾“å…¥æ¡†ä½ç½®å˜åŒ–
```

## ğŸ“ æŠ€æœ¯æ€»ç»“

è¿™æ¬¡æ”¹è¿›æ˜¾è‘—æå‡äº† TUI çš„ç”¨æˆ·ä½“éªŒï¼š

1. **è‡ªç„¶çš„äº¤äº’æ¨¡å¼** - æ»šåŠ¨å’Œå¸ƒå±€æ›´ç¬¦åˆç”¨æˆ·æœŸæœ›
2. **å›½é™…åŒ–æ”¯æŒ** - å®Œæ•´çš„ä¸­æ–‡ç­‰å¤šè¯­è¨€è¾“å…¥æ”¯æŒ  
3. **ç°ä»£åŒ–æ¶æ„** - ä¸ºé›†æˆå…ˆè¿›çš„ TUI ç»„ä»¶åšå¥½å‡†å¤‡
4. **å¯é æ€§æå‡** - æ›´å¥½çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†

æ•´ä½“è€Œè¨€ï¼ŒAlex çš„ TUI ç³»ç»Ÿç°åœ¨æä¾›äº†æ›´åŠ æµç•…ã€ç›´è§‚å’ŒåŠŸèƒ½ä¸°å¯Œçš„ç»ˆç«¯ç”¨æˆ·ç•Œé¢ä½“éªŒã€‚